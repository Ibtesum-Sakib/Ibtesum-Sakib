import requests
import xml.etree.ElementTree as ET

# Fetch RSS feed
feed_url = 'https://medium.com/feed/@ibtesum38'
response = requests.get(feed_url)
response.raise_for_status()  # Ensure we got a successful response
tree = ET.ElementTree(ET.fromstring(response.content))
root = tree.getroot()

# Start building the new section for README
readme_content = "## üìù Latest Medium Posts\n\n"

# Extract titles, links, and images
for item in root.findall(".//item"):
    title = item.find("title").text if item.find("title") is not None else "No Title"
    link = item.find("link").text if item.find("link") is not None else "No Link"
    description = item.find("description").text if item.find("description") is not None else ""
    
    # Try to extract the image URL from the description
    image_url = ""
    if 'src="' in description:
        image_url = description.split('src="')[1].split('"')[0]

    # Format the post title with image
    if image_url:
        readme_content += f"- [![{title}]({image_url})]({link})\n"
    else:
        readme_content += f"- [{title}]({link})\n"

# Open README.md to update it
with open("README.md", "r") as f:
    readme_data = f.read()

# Replace the blog section
readme_data = readme_data.split("<!-- BLOG-POST-LIST:START -->")[0] + \
              "<!-- BLOG-POST-LIST:START -->\n" + readme_content + "<!-- BLOG-POST-LIST:END -->\n" + \
              readme_data.split("<!-- BLOG-POST-LIST:END -->")[1:]

# Save the updated README
with open("README.md", "w") as f:
    f.write(readme_data)
